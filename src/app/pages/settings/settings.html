<!-- settings.component.html -->
<div class="card p-6">
  <!-- Header -->
  <div class="text-center py-3">
    <div class="items-center px-8 py-4 rounded-2xl">
        <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-linear-to-r from-tertiary-300 to-secondary-600"
          >
        Account Settings
      </h1>
    </div>
  </div>

  <!-- Display Name -->
  <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-6 mb-6">
    <h3 class="text-lg font-bold mb-4 text-secondary-400">Display Name</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm text-gray-400 mb-1">Current Name</label>
        <input type="text" pInputText readonly [(ngModel)]="currentUser.displayName"
          class="w-full bg-[#0d0d0d] border border-gray-700 text-gray-300 rounded-md" />
      </div>
      <div>
        <label class="block text-sm text-gray-400 mb-1">New Name</label>
        <input type="text" pInputText [(ngModel)]="newDisplayName"
          class="w-full bg-[#0d0d0d] border border-gray-700 text-white rounded-md focus:ring"
          style="--tw-ring-color: var(--color-secondary-300);" />
      </div>
      <div class="flex items-end">
        <button (click)="updateDisplayName()"
          class="w-full text-white px-4 py-2 rounded-md hover:shadow-md transition font-medium cursor-pointer"
          style="background-image: linear-gradient(to right, var(--color-secondary-500), var(--color-secondary-600));">
          Update
        </button>
      </div>
    </div>
  </div>

  <!-- Email -->
  <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-6 mb-6">
    <h3 class="text-lg font-bold mb-4" style="color: var(--color-secondary-400);">Email Address</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm text-gray-400 mb-1">Current Email</label>
        <input type="text" pInputText readonly [(ngModel)]="currentUser.email"
          class="w-full bg-[#0d0d0d] border border-gray-700 text-gray-300 rounded-md" />
      </div>
      <div>
        <label class="block text-sm text-gray-400 mb-1">New Email</label>
        <input type="email" pInputText [formControl]="emailControl"
          class="w-full bg-[#0d0d0d] border border-gray-700 text-white rounded-md focus:ring"
          style="--tw-ring-color: var(--color-secondary-300);" />
        <small id="email-error" class="text-red-400" *ngIf="emailInUse">Email address already in use.</small>
      </div>
    </div>
    <div class="mt-4 text-right">
      <button (click)="updateEmail()"
        class="text-white px-4 py-2 rounded-md hover:shadow-md transition font-medium cursor-pointer"
        style="background-image: linear-gradient(to right, var(--color-secondary-500), var(--color-secondary-600));">
        Update Email
      </button>
    </div>
  </div>

  <!-- Password -->
  <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-6 mb-6">
    <h3 class="text-lg font-bold mb-4" style="color: var(--color-secondary-400);">Change Password</h3>
    <div class="space-y-4">
      <div>
        <label class="block text-sm text-gray-400 mb-1">Current Password</label>
        <p-password [(ngModel)]="currentPassword" [feedback]="false" [toggleMask]="true" [disabled]="currentUser.google" [ngClass]="{
            'ng-invalid ng-dirty': errorPassword
          }"
          inputStyleClass="w-full bg-[#0d0d0d] border border-gray-700 text-white rounded-md focus:ring"
          [inputStyle]="{ '--tw-ring-color': 'var(--color-secondary-300)' }"
          placeholder="••••••••">
        </p-password>
        <div *ngIf="currentUser.google">
          <small class="text-green-400 block mt-1">Field disabled since you are authenticated with google.</small>
        </div>
        <div *ngIf="errorPassword">
          <small class="block mt-1 text-red-400" [ngClass]="{
            'ng-invalid ng-dirty': errorPassword
          }">{{ errorPassword }}</small>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-400 mb-1">New Password</label>
          <p-password [(ngModel)]="newPassword" [feedback]="true" [toggleMask]="true" [minlength]="8"
            inputStyleClass="w-full bg-[#0d0d0d] border border-gray-700 text-white rounded-md focus:ring"
            [inputStyle]="{ '--tw-ring-color': 'var(--color-secondary-300)' }"
            placeholder="••••••••">
          </p-password>
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">Confirm Password</label>
          <p-password [(ngModel)]="confirmPassword" [feedback]="false" [toggleMask]="true" [minlength]="8"
            inputStyleClass="w-full bg-[#0d0d0d] border border-gray-700 text-white rounded-md focus:ring"
            [inputStyle]="{ '--tw-ring-color': 'var(--color-secondary-300)' }"
            placeholder="••••••••">
          </p-password>
        </div>
      </div>
    </div>
    <div class="mt-4 text-right">
      <button (click)="updatePassword()"
        class="text-white px-4 py-2 rounded-md hover:shadow-md transition font-medium cursor-pointer"
        style="background-image: linear-gradient(to right, var(--color-secondary-500), var(--color-secondary-600));">
        Change Password
      </button>
    </div>
  </div>

  <!-- Danger Zone -->
  <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-6">
    <h3 class="text-lg font-bold text-red-400 mb-4">Danger Zone</h3>
    <div class="flex flex-col md:flex-row justify-between gap-4 items-start md:items-center">
      <div>
        <p class="text-gray-300 mb-1">Permanently delete your account</p>
        <p class="text-sm text-gray-500">This action cannot be undone.</p>
      </div>
      <p-button label="Delete Account" severity="danger" (onClick)="showDeleteDialog()"
        styleClass="bg-red-600 hover:bg-red-700 border border-red-700">
      </p-button>
    </div>
  </div>

  <!-- Delete Dialog -->
  <p-dialog header="Confirm Account Deletion" [(visible)]="displayDeleteDialog" [modal]="true"
    [style]="{ width: 'min(90vw, 450px)' }" [draggable]="false">
    <div class="text-gray-300 mb-6">
      <p>Are you sure you want to permanently delete your account?</p>
      <p>You will be sent an email to confirm deletion.</p>
      <p class="mt-2 text-red-400 font-bold">This action cannot be undone!</p>
      <div class="mt-4">
        <label class="block mb-2">Enter your password to proceed:</label>
        <p-password [(ngModel)]="deletePassword" [feedback]="false" [toggleMask]="true"
          inputStyleClass="w-full bg-[#0d0d0d] border border-gray-700 text-white"
          placeholder="••••••••">
        </p-password>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-2">
        <p-button label="Cancel" severity="secondary" (onClick)="displayDeleteDialog = false"></p-button>
        <p-button label="Delete Account" severity="danger" (onClick)="deleteAccount()"></p-button>
      </div>
    </ng-template>
  </p-dialog>
</div>
